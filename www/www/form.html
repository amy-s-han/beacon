<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Beacon Rewards</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>

 



</head>
<body>
  
  <div class="section no-pad-bot" id="index-banner">
    <div class="container">
      <br><br>
      <h1 class="header center">Beacon</h1>
      <div class="row center">
        <h5 class="header col s12 light"> Disrupting credit card reward goals</h5>
      </div>
      
    </div>
  </div>


  <div class="container">
    
    <div class="section">
      
      <div class="center-wrapper">
        <!-- Dropdown Trigger -->

        <div class="input-field col s12 m6">
          <select class="icons" id ="cardSelect">
            <option value="" disabled active selected>Choose your option</option>
           
              <option value="" data-icon="images/plat.png" class="left " id="tempPlaceholder"> No cards availble </option>
     
          </select>
        </div>
        <br>
      
        <form class="col s6">
         
          <div class="input-field col s6">
            <input placeholder="Rewards Goal" id="rewards-goal" type="number" lass="validate">
            
          </div>

  

         <!-- I was going to add the button here -->

        </form> 
                <button class="btn waves-effect waves-light" id="submitGoal" >Submit
    <i class="material-icons right">send</i>
  </button>
      </div>

        
    </div>
    <br>


  </div>

 


  <!--  Scripts-->

  <script src="js/jquery-3.0.0.min.js"></script>
   <script src="js/materialize.js"></script>

  <script type="text/javascript">
    var rewardsAccs = JSON.parse(JSON.parse(atob('{{rewardAccounts}}')));

    console.log(rewardsAccs.rewardsAccounts.length);



   
    $(document).ready(function(){
   
        console.log("Jquery is ready");
        $( "#tempPlaceholder" ).remove();
        $('select').material_select();
       

       $('#submitGoal').click(function () {
            console.log("test");
            var selectedText  = $("li.selected").text();
            var goall = $('#rewards-goal').val();
            var rewardID;

            for(var i = 0; i < numCards; i++){

              var cardName = rewardsAccs.rewardsAccounts[i].accountDisplayName;
              console.log("Card Name:" + cardName);
              if(cardName ==selectedText ) {
                console.log("Found one " + rewardsAccs.rewardsAccounts[i].rewardsAccountReferenceId );
                rewardID = rewardsAccs.rewardsAccounts[i].rewardsAccountReferenceId;
              }

            }

            if(! isNaN(goall) ) {
                 console.log("ID Sendinng in request with " + rewardID);

                $.ajax({
                    url: "submit",
                    type: "get", //send it through get method
                    data:{id:rewardID,goal:goall},
                    success: function(response) {
                      console.log(response);
                    },
                    error: function(xhr) {
                      //Do Something to handle error
                    }
                  });
            }
            
        });
   


     var numCards = rewardsAccs.rewardsAccounts.length;
      console.log("numCards: " + numCards);

      for(var i = 0; i < numCards; i++){

        var cardName = rewardsAccs.rewardsAccounts[i].accountDisplayName;
        cardNameLower = cardName.toLowerCase();
        console.log("card name: " + cardName);
        var opt = "";

        if(cardNameLower.includes("miles")){
          opt = '<option value= "" data-icon="images/vent.png" class="left ">' + cardName + '</option>';
        } else if(cardNameLower.includes("points")){
          opt = '<option value= "" data-icon="images/plat.png" class="left ">' + cardName + '</option>';
        } else if(cardNameLower.includes("cash")){
          opt = '<option value= "" data-icon="images/qs.png" class="left ">' + cardName + '</option>';
        } else {
          console.log("ERROR: no matches");
        }

        var divider = '<li class="divider"></li>';
        console.log(opt + " " + divider);

        $("#cardSelect").append(opt, divider);

      }

   


      $('select').material_select();

    });
  
    

  </script>


  </body>
</html>
